kind: ConfigMap
apiVersion: v1
metadata:
  name: knative-operators

data:
  customResourceDefinitions: |-
    - apiVersion: apiextensions.k8s.io/v1beta1
      kind: CustomResourceDefinition
      metadata:
        name: channels.eventing.knative.dev
      spec:
        additionalPrinterColumns:
        - JSONPath: .status.conditions[?(@.type=="Ready")].status
          name: Ready
          type: string
        - JSONPath: .status.conditions[?(@.type=="Ready")].reason
          name: Reason
          type: string
        group: eventing.knative.dev
        names:
          categories:
          - all
          - knative
          - eventing
          kind: Channel
          plural: channels
          shortNames:
          - chan
          singular: channel
        scope: Namespaced
        subresources:
          status: {}
        version: v1alpha1

    - apiVersion: apiextensions.k8s.io/v1beta1
      kind: CustomResourceDefinition
      metadata:
        name: clusterchannelprovisioners.eventing.knative.dev
      spec:
        additionalPrinterColumns:
        - JSONPath: .status.conditions[?(@.type=="Ready")].status
          name: Ready
          type: string
        - JSONPath: .status.conditions[?(@.type=="Ready")].reason
          name: Reason
          type: string
        group: eventing.knative.dev
        names:
          categories:
          - all
          - knative
          - eventing
          - provisioner
          kind: ClusterChannelProvisioner
          plural: clusterchannelprovisioners
          shortNames:
          - ccp
          singular: clusterchannelprovisioner
        scope: Cluster
        subresources:
          status: {}
        version: v1alpha1

    - apiVersion: apiextensions.k8s.io/v1beta1
      kind: CustomResourceDefinition
      metadata:
        name: subscriptions.eventing.knative.dev
      spec:
        additionalPrinterColumns:
        - JSONPath: .status.conditions[?(@.type=="Ready")].status
          name: Ready
          type: string
        - JSONPath: .status.conditions[?(@.type=="Ready")].reason
          name: Reason
          type: string
        group: eventing.knative.dev
        names:
          categories:
          - all
          - knative
          - eventing
          kind: Subscription
          plural: subscriptions
          shortNames:
          - sub
          singular: subscription
        scope: Namespaced
        subresources:
          status: {}
        version: v1alpha1
    - apiVersion: apiextensions.k8s.io/v1beta1
      kind: CustomResourceDefinition
      metadata:
        name: installs.eventing.knative.dev
      spec:
        group: eventing.knative.dev
        names:
          kind: Install
          listKind: InstallList
          plural: installs
          singular: install
          shortNames:
          - kei
        scope: Namespaced
        subresources:
          status: {}
        validation:
          openAPIV3Schema:
            properties:
              apiVersion:
                type: string
              kind:
                type: string
              metadata:
                type: object
              spec:
                type: object
              status:
                type: object
        version: v1alpha1
        versions:
        - name: v1alpha1
          served: true
          storage: true
    - apiVersion: apiextensions.k8s.io/v1beta1
      kind: CustomResourceDefinition
      metadata:
        labels:
          eventing.knative.dev/source: "true"
        name: awssqssources.sources.eventing.knative.dev
      spec:
        group: sources.eventing.knative.dev
        names:
          categories:
          - all
          - knative
          - eventing
          - sources
          kind: AwsSqsSource
          plural: awssqssources
        scope: Namespaced
        subresources:
          status: {}
        validation:
          openAPIV3Schema:
            properties:
              apiVersion:
                type: string
              kind:
                type: string
              metadata:
                type: object
              spec:
                properties:
                  awsCredsSecret:
                    type: object
                  queueUrl:
                    type: string
                  serviceAccountName:
                    type: string
                  sink:
                    type: object
                required:
                - queueUrl
                type: object
              status:
                properties:
                  conditions:
                    items:
                      properties:
                        lastTransitionTime:
                          type: string
                        message:
                          type: string
                        reason:
                          type: string
                        severity:
                          type: string
                        status:
                          type: string
                        type:
                          type: string
                      required:
                      - type
                      - status
                      type: object
                    type: array
                  sinkUri:
                    type: string
                type: object
        version: v1alpha1

    - apiVersion: apiextensions.k8s.io/v1beta1
      kind: CustomResourceDefinition
      metadata:
        labels:
          eventing.knative.dev/source: "true"
        name: containersources.sources.eventing.knative.dev
      spec:
        group: sources.eventing.knative.dev
        names:
          categories:
          - all
          - knative
          - eventing
          - sources
          kind: ContainerSource
          plural: containersources
        scope: Namespaced
        subresources:
          status: {}
        validation:
          openAPIV3Schema:
            properties:
              apiVersion:
                type: string
              kind:
                type: string
              metadata:
                type: object
              spec:
                properties:
                  args:
                    items:
                      type: string
                    type: array
                  env:
                    items:
                      type: object
                    type: array
                  image:
                    minLength: 1
                    type: string
                  serviceAccountName:
                    type: string
                  sink:
                    type: object
                type: object
              status:
                properties:
                  conditions:
                    items:
                      properties:
                        lastTransitionTime:
                          type: string
                        message:
                          type: string
                        reason:
                          type: string
                        severity:
                          type: string
                        status:
                          type: string
                        type:
                          type: string
                      required:
                      - type
                      - status
                      type: object
                    type: array
                  sinkUri:
                    type: string
                type: object
        version: v1alpha1

    - apiVersion: apiextensions.k8s.io/v1beta1
      kind: CustomResourceDefinition
      metadata:
        labels:
          eventing.knative.dev/source: "true"
        name: cronjobsources.sources.eventing.knative.dev
      spec:
        group: sources.eventing.knative.dev
        names:
          categories:
          - all
          - knative
          - eventing
          - sources
          kind: CronJobSource
          plural: cronjobsources
        scope: Namespaced
        subresources:
          status: {}
        validation:
          openAPIV3Schema:
            properties:
              apiVersion:
                type: string
              kind:
                type: string
              metadata:
                type: object
              spec:
                properties:
                  data:
                    type: string
                  schedule:
                    type: string
                  serviceAccountName:
                    type: string
                  sink:
                    type: object
                required:
                - schedule
                type: object
              status:
                properties:
                  conditions:
                    items:
                      properties:
                        lastTransitionTime:
                          type: string
                        message:
                          type: string
                        reason:
                          type: string
                        severity:
                          type: string
                        status:
                          type: string
                        type:
                          type: string
                      required:
                      - type
                      - status
                      type: object
                    type: array
                  sinkUri:
                    type: string
                type: object
        version: v1alpha1

    - apiVersion: apiextensions.k8s.io/v1beta1
      kind: CustomResourceDefinition
      metadata:
        labels:
          eventing.knative.dev/source: "true"
        name: githubsources.sources.eventing.knative.dev
      spec:
        group: sources.eventing.knative.dev
        names:
          categories:
          - all
          - knative
          - eventing
          - sources
          kind: GitHubSource
          plural: githubsources
        scope: Namespaced
        subresources:
          status: {}
        validation:
          openAPIV3Schema:
            properties:
              apiVersion:
                type: string
              kind:
                type: string
              metadata:
                type: object
              spec:
                properties:
                  accessToken:
                    properties:
                      secretKeyRef:
                        type: object
                    type: object
                  eventTypes:
                    items:
                      enum:
                      - commit_comment
                      - create
                      - delete
                      - deployment
                      - deployment_status
                      - fork
                      - gollum
                      - installation
                      - integration_installation
                      - issue_comment
                      - issues
                      - label
                      - member
                      - membership
                      - milestone
                      - organization
                      - org_block
                      - page_build
                      - ping
                      - project_card
                      - project_column
                      - project
                      - public
                      - pull_request
                      - pull_request_review
                      - pull_request_review_comment
                      - push
                      - release
                      - repository
                      - status
                      - team
                      - team_add
                      - watch
                      type: string
                    minItems: 1
                    type: array
                  ownerAndRepository:
                    minLength: 1
                    type: string
                  secretToken:
                    properties:
                      secretKeyRef:
                        type: object
                    type: object
                  serviceAccountName:
                    type: string
                  sink:
                    type: object
                required:
                - ownerAndRepository
                - eventTypes
                - accessToken
                - secretToken
                type: object
              status:
                properties:
                  conditions:
                    items:
                      properties:
                        lastTransitionTime:
                          type: string
                        message:
                          type: string
                        reason:
                          type: string
                        severity:
                          type: string
                        status:
                          type: string
                        type:
                          type: string
                      required:
                      - type
                      - status
                      type: object
                    type: array
                  sinkUri:
                    type: string
                  webhookIDKey:
                    type: string
                type: object
        version: v1alpha1

    - apiVersion: apiextensions.k8s.io/v1beta1
      kind: CustomResourceDefinition
      metadata:
        labels:
          eventing.knative.dev/source: "true"
        name: kuberneteseventsources.sources.eventing.knative.dev
      spec:
        group: sources.eventing.knative.dev
        names:
          categories:
          - all
          - knative
          - eventing
          - sources
          kind: KubernetesEventSource
          plural: kuberneteseventsources
        scope: Namespaced
        subresources:
          status: {}
        validation:
          openAPIV3Schema:
            properties:
              apiVersion:
                type: string
              kind:
                type: string
              metadata:
                type: object
              spec:
                properties:
                  namespace:
                    type: string
                  serviceAccountName:
                    type: string
                  sink:
                    type: object
                required:
                - namespace
                type: object
              status:
                properties:
                  conditions:
                    items:
                      properties:
                        lastTransitionTime:
                          type: string
                        message:
                          type: string
                        reason:
                          type: string
                        severity:
                          type: string
                        status:
                          type: string
                        type:
                          type: string
                      required:
                      - type
                      - status
                      type: object
                    type: array
                  sinkUri:
                    type: string
                type: object
        version: v1alpha1
  clusterServiceVersions: |-
    - apiVersion: operators.coreos.com/v1alpha1
      kind: ClusterServiceVersion
      metadata:
        name: knative-eventing.v0.4.1
      spec:
        displayName: Knative Eventing
        description: |
          Kubernetes-native Eventing resource
        version: 0.4.1
        maturity: alpha
        replaces: knative-eventing.v0.3.0

        installModes:
        - supported: true
          type: OwnNamespace
        - supported: true
          type: SingleNamespace
        - supported: false
          type: MultiNamespace
        - supported: true
          type: AllNamespaces

        install:
          strategy: deployment
          spec:
            clusterPermissions:

            - serviceAccountName: eventing-controller
              rules:
              - apiGroups:
                - '*'
                resources:
                - '*'
                verbs:
                - '*'
              - nonResourceURLs:
                - '*'
                verbs:
                - '*'

            - serviceAccountName: in-memory-channel-controller
              rules:
              - apiGroups:
                - eventing.knative.dev
                resources:
                - channels
                - channels/status
                - clusterchannelprovisioners
                - clusterchannelprovisioners/status
                verbs:
                - get
                - list
                - watch
                - update
              - apiGroups:
                - eventing.knative.dev
                resources:
                - '*/finalizers'
                verbs:
                - update
              - apiGroups:
                - ""
                resources:
                - configmaps
                - services
                verbs:
                - get
                - list
                - watch
                - create
              - apiGroups:
                - ""
                resourceNames:
                - in-memory-channel-clusterbus
                resources:
                - services
                verbs:
                - delete
              - apiGroups:
                - ""
                resources:
                - services
                verbs:
                - update
              - apiGroups:
                - ""
                resourceNames:
                - in-memory-channel-dispatcher-config-map
                resources:
                - configmaps
                verbs:
                - update
              - apiGroups:
                - networking.istio.io
                resources:
                - virtualservices
                verbs:
                - get
                - list
                - watch
                - create
                - update
              - apiGroups:
                - ""
                resources:
                - events
                verbs:
                - create
                - patch
                - update

            - serviceAccountName: in-memory-channel-dispatcher
              rules:
              - apiGroups:
                - ""
                resources:
                - configmaps
                verbs:
                - get
                - list
                - watch

              # The above rules are from upstream. The remaining are
              # required for OpenShift

              - apiGroups:
                - security.openshift.io
                resources:
                - securitycontextconstraints
                verbs:
                - use
                resourceNames:
                - privileged

            - serviceAccountName: controller-manager
              rules:
              - apiGroups:
                - sources.eventing.knative.dev
                resources:
                - awssqssources
                - containersources
                - cronjobsources
                - githubsources
                - kuberneteseventsources
                verbs:
                - get
                - list
                - watch
                - create
                - update
                - patch
                - delete
              - apiGroups:
                - sources.eventing.knative.dev
                resources:
                - awssqssources/status
                - containersources/status
                - cronjobsources/status
                - githubsources/status
                - kuberneteseventsources/status
                verbs:
                - get
                - update
                - patch
              - apiGroups:
                - apps
                resources:
                - deployments
                verbs:
                - get
                - list
                - watch
                - create
                - update
                - patch
                - delete
              - apiGroups:
                - eventing.knative.dev
                resources:
                - channels
                verbs:
                - get
                - list
                - watch
              - apiGroups:
                - serving.knative.dev
                resources:
                - services
                verbs:
                - get
                - list
                - watch
                - create
                - update
                - patch
                - delete
              - apiGroups:
                - ""
                resources:
                - secrets
                verbs:
                - get
                - list
                - watch
              - apiGroups:
                - ""
                resources:
                - events
                verbs:
                - get
                - list
                - watch
                - create
                - update
                - patch
                - delete

            deployments:
            - name: knative-eventing-operator
              spec:
                replicas: 1
                selector:
                  matchLabels:
                    name: knative-eventing-operator
                template:
                  metadata:
                    labels:
                      name: knative-eventing-operator
                  spec:
                    serviceAccountName: eventing-controller
                    containers:
                      - name: knative-eventing-operator
                        image: quay.io/jcrossley3/knative-eventing-operator:0.4.1
                        command:
                        - knative-eventing-operator
                        args:
                          - --olm
                          - --install
                          - --override-namespace
                        env:
                          - name: WATCH_NAMESPACE
                            valueFrom:
                              fieldRef:
                                fieldPath: metadata.namespace
                          - name: POD_NAME
                            valueFrom:
                              fieldRef:
                                fieldPath: metadata.name
                          - name: OPERATOR_NAME
                            value: "knative-eventing-operator"

        customresourcedefinitions:
          owned:
            - name: channels.eventing.knative.dev
              kind: Channel
              description: Channel
              displayName: Channel
              version: v1alpha1
            - name: clusterchannelprovisioners.eventing.knative.dev
              kind: ClusterChannelProvisioner
              description: ClusterChannelProvisioner
              displayName: ClusterChannelProvisioner
              version: v1alpha1
            - name: subscriptions.eventing.knative.dev
              kind: Subscription
              description: Subscription
              displayName: Subscription
              version: v1alpha1
            - name: containersources.sources.eventing.knative.dev
              kind: ContainerSource
              description: ContainerSource
              displayName: ContainerSource
              version: v1alpha1
            - name: githubsources.sources.eventing.knative.dev
              kind: GitHubSource
              description: GitHubSource
              displayName: GitHubSource
              version: v1alpha1
            - name: kuberneteseventsources.sources.eventing.knative.dev
              kind: KubernetesEventSource
              description: KubernetesEventSource
              displayName: KubernetesEventSource
              version: v1alpha1
            - name: cronjobsources.sources.eventing.knative.dev
              kind: CronJobSource
              description: CronJobSource
              displayName: CronJobSource
              version: v1alpha1
            - name: awssqssources.sources.eventing.knative.dev
              kind: AwsSqsSource
              description: AwsSqsSource
              displayName: AwsSqsSource
              version: v1alpha1
            - description: Knative Eventing Installation
              displayName: Install Operator
              kind: Install
              name: installs.eventing.knative.dev
              version: v1alpha1
  packages: |-
    - packageName: knative-eventing
      channels:
      - name: alpha
        currentCSV: knative-eventing.v0.4.1
---
apiVersion: operators.coreos.com/v1alpha1
kind: CatalogSource
metadata:
  name: knative-operators
spec:
  configMap: knative-operators
  displayName: Knative Operators
  publisher: Red Hat
  sourceType: internal
